<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Last Shinobi Battle</title>
<style>
  body { margin:0; font-family:sans-serif; background:#222; color:#fff; text-align:center;}
  canvas { display:block; margin:0 auto; border:2px solid #000; background: linear-gradient(#87ceeb, #00aaff);}
  #ui { margin-top:10px;}
  button { margin:5px; padding:10px 20px; font-size:16px; cursor:pointer;}
  .element { display:inline-block; padding:5px 10px; border:1px solid #fff; margin:2px; cursor:pointer; }
  .element.selected { border:2px solid yellow; }
</style>
</head>
<body>

<h1>Last Shinobi Battle</h1>
<div id="menu">
  <button onclick="startSingleplayer()">Singleplayer</button>
  <button onclick="alert('Multiplayer coming soon!')">Multiplayer</button>
  <button onclick="openSettings()">Settings</button>
</div>

<div id="settings" style="display:none;">
  <h2>Settings</h2>
  <p>Volume: <input type="range" min="0" max="100" value="50" id="volumeRange"></p>
  <button onclick="backToMenu()">Back</button>
</div>

<div id="characterSelect" style="display:none;">
  <h2>Select Your Character</h2>
  <div id="characterBox" style="width:50px;height:50px;background:blue;margin:0 auto;"></div>
  <div id="elementMenu" style="text-align:right;">
    <div class="element" title="Fire: Low damage" onclick="selectElement('Fire')">Fire</div>
    <div class="element" title="Water: Low damage" onclick="selectElement('Water')">Water</div>
    <div class="element" title="Wind: Low damage" onclick="selectElement('Wind')">Wind</div>
    <div class="element" title="Earth: Low damage" onclick="selectElement('Earth')">Earth</div>
    <div class="element" title="Lightning: Low damage" onclick="selectElement('Lightning')">Lightning</div>
  </div>
  <button onclick="startGame()">Start</button>
</div>

<div id="loadingScreen" style="display:none;">
  <h2>Loading...</h2>
  <div style="width:300px;height:20px;border:1px solid #fff;margin:0 auto;">
    <div id="loadingBar" style="height:100%;width:0%;background:green;"></div>
  </div>
</div>

<div id="gameArea" style="display:none;">
  <canvas id="gameCanvas" width="700" height="400"></canvas>
  <div id="ui">
    <p id="playerHP">HP: 100</p>
    <p id="specialBar">Special: 0/100</p>
    <p id="elementAmmo"></p>
  </div>
</div>

<div id="endScreen" style="display:none;">
  <h2 id="endMessage"></h2>
  <button onclick="rematch()">Rematch</button>
  <button onclick="backToMenu()">Menu</button>
</div>

<script>
let selectedElements = [];
let elementAmmo = {};
let gameState = 'menu';

const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let player = { x:50, y:200, size:30, color:'blue', hp:100, special:0, angle:0 };
let enemy = { x:620, y:200, size:30, color:'red', hp:100, shootTimer:0 };
let keys = {};
let bullets = [];
let chests = [];

const jutsuSpeed = 5;
const jutsuDamage = 3;
const specialDamage = 10;

// ---------- MENU & SETTINGS ----------
function startSingleplayer(){
  document.getElementById('menu').style.display='none';
  document.getElementById('characterSelect').style.display='block';
}

function openSettings(){
  document.getElementById('menu').style.display='none';
  document.getElementById('settings').style.display='block';
}

function backToMenu(){
  document.getElementById('menu').style.display='block';
  document.getElementById('settings').style.display='none';
  document.getElementById('characterSelect').style.display='none';
  document.getElementById('endScreen').style.display='none';
  document.getElementById('gameArea').style.display='none';
  gameState='menu';
}

// ---------- CHARACTER SELECT ----------
function selectElement(name){
  if(selectedElements.includes(name)) selectedElements = selectedElements.filter(e=>e!==name);
  else if(selectedElements.length<2) selectedElements.push(name);
  updateElementMenu();
}

function updateElementMenu(){
  const elems = document.querySelectorAll('.element');
  elems.forEach(e=>{
    if(selectedElements.includes(e.innerText)) e.classList.add('selected');
    else e.classList.remove('selected');
  });
}

function startGame(){
  if(selectedElements.length<2){ alert('Select 2 elements!'); return; }
  document.getElementById('characterSelect').style.display='none';
  document.getElementById('loadingScreen').style.display='block';
  let bar = document.getElementById('loadingBar');
  let width=0;
  let interval = setInterval(()=>{
    width+=1;
    bar.style.width=width+'%';
    if(width>=100){ clearInterval(interval); initBattle(); }
  }, 30);
}

// ---------- INIT BATTLE ----------
function initBattle(){
  document.getElementById('loadingScreen').style.display='none';
  document.getElementById('gameArea').style.display='block';
  selectedElements.forEach(e=>elementAmmo[e]=6);
  gameState='playing';
  spawnChests(5);
  requestAnimationFrame(gameLoop);
}

// ---------- INPUT ----------
window.addEventListener('keydown', e=>keys[e.key.toLowerCase()]=true);
window.addEventListener('keyup', e=>keys[e.key.toLowerCase()]=false);

canvas.addEventListener('mousemove', function(e){
  const rect = canvas.getBoundingClientRect();
  player.mouseX = e.clientX - rect.left;
  player.mouseY = e.clientY - rect.top;
});

// ---------- SPAWN CHESTS ----------
function spawnChests(num){
  for(let i=0;i<num;i++){
    chests.push({x:Math.random()*(canvas.width-30),y:Math.random()*(canvas.height-30),size:20});
  }
}

// ---------- GAME LOOP ----------
function gameLoop(){
  if(gameState!=='playing') return;
  
  // ---- player rotation to mouse ----
  player.angle = Math.atan2(player.mouseY-(player.y+player.size/2), player.mouseX-(player.x+player.size/2));
  
  // ---- movement ----
  if(keys['w'] && player.y>0) player.y-=3;
  if(keys['s'] && player.y<canvas.height-player.size) player.y+=3;
  if(keys['a'] && player.x>0) player.x-=3;
  if(keys['d'] && player.x<canvas.width-player.size) player.x+=3;

  // ---- firing elements ----
  if(keys['e'] && elementAmmo[selectedElements[0]]>0){
    fireBullet(selectedElements[0]);
    elementAmmo[selectedElements[0]]-=1;
    keys['e']=false;
  }
  if(keys['q'] && elementAmmo[selectedElements[1]]>0){
    fireBullet(selectedElements[1]);
    elementAmmo[selectedElements[1]]-=1;
    keys['q']=false;
  }
  // special attack
  if(keys['e'] && keys['q'] && player.special>=100){
    bullets.push({x:player.x+player.size/2, y:player.y+player.size/2, dx:8*Math.cos(player.angle), dy:8*Math.sin(player.angle), color:'purple', owner:'player', special:true});
    player.special=0;
  }

  // ---- AI movement (random) ----
  enemy.shootTimer++;
  if(enemy.shootTimer>60){
    enemy.shootTimer=0;
    let angle = Math.random()*Math.PI*2;
    bullets.push({x:enemy.x+enemy.size/2, y:enemy.y+enemy.size/2, dx:4*Math.cos(angle), dy:4*Math.sin(angle), color:'red', owner:'enemy'});
  }
  if(Math.random()<0.02){ enemy.x += (Math.random()>0.5?2:-2); enemy.y += (Math.random()>0.5?2:-2); }

  // ---- bullets update ----
  bullets.forEach((b,i)=>{
    b.x += b.dx;
    b.y += b.dy;
    // collision player
    if(b.owner==='enemy' &&
      b.x>player.x && b.x<player.x+player.size &&
      b.y>player.y && b.y<player.y+player.size){
        player.hp -= b.special?specialDamage:jutsuDamage;
        bullets.splice(i,1);
    }
    // collision enemy
    if(b.owner==='player' &&
      b.x>enemy.x && b.x<enemy.x+enemy.size &&
      b.y>enemy.y && b.y<enemy.y+enemy.size){
        enemy.hp -= b.special?specialDamage:jutsuDamage;
        if(!b.special) player.special +=5;
        bullets.splice(i,1);
    }
    // out of canvas
    if(b.x<0 || b.x>canvas.width || b.y<0 || b.y>canvas.height) bullets.splice(i,1);
  });

  // ---- chest collision ----
  chests.forEach((c,i)=>{
    if(player.x+player.size>c.x && player.x<c.x+c.size && player.y+player.size>c.y && player.y<c.y+c.size){
      selectedElements.forEach(e=>elementAmmo[e]=6);
      chests.splice(i,1);
    }
  });

  // ---- draw arena ----
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // draw chests
  chests.forEach(c=>{
    ctx.fillStyle='gold';
    ctx.fillRect(c.x,c.y,c.size,c.size);
  });

  // draw player
  ctx.save();
  ctx.translate(player.x+player.size/2,player.y+player.size/2);
  ctx.rotate(player.angle);
  ctx.fillStyle=player.color;
  ctx.fillRect(-player.size/2,-player.size/2,player.size,player.size);
  ctx.restore();

  // draw enemy
  ctx.fillStyle=enemy.color;
  ctx.fillRect(enemy.x,enemy.y,enemy.size,enemy.size);

  // draw bullets
  bullets.forEach(b=>{
    ctx.fillStyle=b.color==='Fire'?'orange':b.color==='Water'?'cyan':b.color==='Wind'?'white':b.color==='Earth'?'brown':'purple';
    ctx.beginPath();
    ctx.arc(b.x,b.y,8,0,Math.PI*2);
    ctx.fill();
  });

  // ---- UI ----
  document.getElementById('playerHP').innerText=`HP: ${player.hp}`;
  document.getElementById('specialBar').innerText=`Special: ${player.special}/100`;
  let ammoText='';
  selectedElements.forEach(e=> ammoText+=`${e}: ${elementAmmo[e]}/6  `);
  document.getElementById('elementAmmo').innerText=ammoText;

  // ---- check win/lose ----
  if(player.hp<=0 || enemy.hp<=0){
    gameState='end';
    document.getElementById('gameArea').style.display='none';
    document.getElementById('endScreen').style.display='block';
    document.getElementById('endMessage').innerText=player.hp>0?"You won! You earned 8 trophies":"Better luck next time";
  } else requestAnimationFrame(gameLoop);
}

// ---------- FIRE BULLET ----------
function fireBullet(element){
  let color = element==='Fire'?'orange':element==='Water'?'cyan':element==='Wind'?'white':element==='Earth'?'brown':'yellow';
  bullets.push({x:player.x+player.size/2, y:player.y+player.size/2, dx:jutsuSpeed*Math.cos(player.angle), dy:jutsuSpeed*Math.sin(player.angle), color:color, owner:'player'});
}

// ---------- REMATCH ----------
function rematch(){
  bullets=[];
  chests=[];
  player={ x:50, y:200, size:30, color:'blue', hp:100, special:0, angle:0 };
  enemy={ x:620, y:200, size:30, color:'red', hp:100, shootTimer:0 };
  Object.keys(elementAmmo).forEach(e=>elementAmmo[e]=6);
  spawnChests(5);
  document.getElementById('endScreen').style.display='none';
  document.getElementById('gameArea').style.display='block';
  gameState='playing';
  requestAnimationFrame(gameLoop);
}
</script>
</body>
</html>











