<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Last Shinobi Standing 3D</title>
<style>
body { margin:0; overflow:hidden; background:#111; }
#ui {position:absolute; top:10px; left:10px; color:white; font-family:sans-serif;}
#ui p {margin:5px;}
#info {position:absolute; top:10px; right:10px; color:white; font-family:sans-serif;}
</style>
</head>
<body>
<div id="ui">
<p id="hp">HP: 100</p>
<p id="special">Special: 0/100</p>
<p id="score">Score: 0</p>
</div>
<div id="info">Click to start | WASD: Move | Mouse: Look | E/Q attack | E+Q special</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>

<script>
// ---------- SCENE ----------
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x222222);

// ---------- CAMERA ----------
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0,5,10);

// ---------- RENDERER ----------
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ---------- LIGHT ----------
const ambient = new THREE.AmbientLight(0xffffff,0.7);
scene.add(ambient);
const directional = new THREE.DirectionalLight(0xffffff,0.8);
directional.position.set(10,20,10);
scene.add(directional);

// ---------- FLOOR ----------
const floorGeo = new THREE.PlaneGeometry(50,50);
const floorMat = new THREE.MeshStandardMaterial({color:0x555555});
const floor = new THREE.Mesh(floorGeo,floorMat);
floor.rotation.x=-Math.PI/2;
scene.add(floor);

// ---------- PLAYER ----------
const playerGeo = new THREE.BoxGeometry(1,1,1);
const playerMat = new THREE.MeshStandardMaterial({color:0x0000ff});
const player = new THREE.Mesh(playerGeo,playerMat);
player.position.set(0,0.5,0);
scene.add(player);

// ---------- ENEMY ----------
const enemyGeo = new THREE.BoxGeometry(1,1,1);
const enemyMat = new THREE.MeshStandardMaterial({color:0xff0000});
const enemy = new THREE.Mesh(enemyGeo,enemyMat);
enemy.position.set(5,0.5,0);
scene.add(enemy);

// ---------- OBSTACLES ----------
let obstacles=[];
function createObstacles(){
  const data = [
    {x:5,z:0,w:1,h:10},{x:-5,z:-5,w:1,h:5},{x:0,z:5,w:3,h:1}
  ];
  data.forEach(d=>{
    const geo = new THREE.BoxGeometry(d.w,1,d.h);
    const mat = new THREE.MeshStandardMaterial({color:0x888888});
    const mesh = new THREE.Mesh(geo,mat);
    mesh.position.set(d.x,0.5,d.z);
    scene.add(mesh);
    obstacles.push(mesh);
  });
}
createObstacles();

// ---------- CONTROLS ----------
const controls = new THREE.PointerLockControls(camera,document.body);
document.body.addEventListener('click',()=>{controls.lock();});

// ---------- INPUT ----------
let keys={};
window.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

// ---------- GAME VARIABLES ----------
let bullets=[];
let playerHP=100;
let playerSpecial=0;
let score=0;

// ---------- BULLETS ----------
function shoot(type,special=false){
  const geo = new THREE.SphereGeometry(special?0.3:0.2,8,8);
  const color = type==='Fire'?0xff4500:type==='Water'?0x1e90ff:0xffff00;
  const mat = new THREE.MeshStandardMaterial({color});
  const bullet = new THREE.Mesh(geo,mat);
  bullet.position.set(player.position.x,player.position.y+0.5,player.position.z);
  const dir = new THREE.Vector3(0,0,-1).applyEuler(player.rotation);
  bullet.userData={dir,type,owner:'player',special};
  bullets.push(bullet);
  scene.add(bullet);
}

// ---------- HIT CHECK ----------
function hitCheck(b,target){
  const dx=b.position.x-target.position.x;
  const dz=b.position.z-target.position.z;
  return Math.abs(dx)<0.5 && Math.abs(dz)<0.5;
}

// ---------- GAME LOOP ----------
function animate(){
  requestAnimationFrame(animate);

  // PLAYER MOVE
  const speed=0.15;
  let nx=player.position.x;
  let nz=player.position.z;
  if(keys['w']) nz-=speed;
  if(keys['s']) nz+=speed;
  if(keys['a']) nx-=speed;
  if(keys['d']) nx+=speed;
  if(!obstacles.some(o=>Math.abs(nx-o.position.x)<0.5 && Math.abs(nz-o.position.z)<0.5)) player.position.x=nx;
  if(!obstacles.some(o=>Math.abs(nx-o.position.x)<0.5 && Math.abs(nz-o.position.z)<0.5)) player.position.z=nz;

  // ROTATE PLAYER TOWARD CAMERA
  const dir = new THREE.Vector3();
  camera.getWorldDirection(dir);
  player.rotation.y = Math.atan2(dir.x, dir.z);

  // ENEMY AI MOVE
  const dx = player.position.x - enemy.position.x;
  const dz = player.position.z - enemy.position.z;
  const dist = Math.sqrt(dx*dx + dz*dz);
  if(dist>2){
    enemy.position.x += dx/dist*0.08;
    enemy.position.z += dz/dist*0.08;
  }

  // ENEMY SHOOT
  if(Math.random()<0.01){
    const geo = new THREE.SphereGeometry(0.2,8,8);
    const mat = new THREE.MeshStandardMaterial({color:0xffd700});
    const bullet = new THREE.Mesh(geo,mat);
    bullet.position.set(enemy.position.x,enemy.position.y+0.5,enemy.position.z);
    const dir = new THREE.Vector3(player.position.x-enemy.position.x,0,player.position.z-enemy.position.z).normalize();
    bullet.userData={dir,type:'Fire',owner:'enemy',special:false};
    bullets.push(bullet);
    scene.add(bullet);
  }

  // UPDATE BULLETS
  bullets.forEach((b,i)=>{
    b.position.add(b.userData.dir.clone().multiplyScalar(0.25));
    if(b.userData.owner==='enemy' && hitCheck(b,player)){playerHP -= b.userData.special?10:5; scene.remove(b); bullets.splice(i,1);}
    if(b.userData.owner==='player' && hitCheck(b,enemy)){scene.remove(b); bullets.splice(i,1); score+=10;}
    if(Math.abs(b.position.x)>25 || Math.abs(b.position.z)>25){ scene.remove(b); bullets.splice(i,1);}
  });

  // CAMERA FOLLOW
  camera.position.x = player.position.x;
  camera.position.z = player.position.z + 10;
  camera.position.y = player.position.y + 5;
  camera.lookAt(player.position);

  // UI
  document.getElementById('hp').innerText='HP: '+playerHP;
  document.getElementById('special').innerText='Special: '+playerSpecial+'/100';
  document.getElementById('score').innerText='Score: '+score;

  // GAME OVER
  if(playerHP<=0){ alert('Game Over! Score: '+score); return; }

  renderer.render(scene,camera);
}

// ---------- ATTACK INPUT ----------
window.addEventListener('keydown',e=>{
  if(e.key.toLowerCase()==='e') shoot('Fire');
  if(e.key.toLowerCase()==='q') shoot('Water');
  if(e.key.toLowerCase()==='e' && keys['q']) shoot('Steam',true);
});

animate();
</script>
</body>
</html>































